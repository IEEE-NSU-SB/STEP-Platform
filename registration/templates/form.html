{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registration Form</title>
  <link rel="icon" href="{% static '/img/logo.gif' %}" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- sweet alert  -->
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#055f8b",
            secondary: "#f17727",
          },
        },
      },
    };
  </script>
  <style>
    body{
        background-image: url("{% static '/img/StepBG.png' %}");
        background-repeat: no-repeat;
        background-size: cover;
    }
    @media screen and (max-width:500px){
      .response_count{
        margin: 0 auto;
      }
    }
  </style>
</head>

<body class="min-h-screen py-8">
   <nav class="w-11/12 md:w-3/5 mx-auto flex justify-between my-4">
    <div class="rounded overflow-hidden object-cover">
      <img src="{% static '/img/StepBanner.jpeg' %}" alt="">
    </div>
  </nav>
  {% if is_staff_view %}
  <!-- admin feature part  -->
  <!-- Button Header -->
  <div class="rounded">

  <div class="bg-[#ffffffaa] w-11/12 md:w-3/5 mx-auto px-6 py-5" style="backdrop-filter:blur(7px); border-radius: 4px 4px 0 0;">
    <!-- <div class="flex flex-wrap gap-3 items-center justify-between"> -->
      <div class="flex flex-col sm:flex-row sm:flex-wrap gap-3 items-center justify-between">
      <div>
        <!-- Publish Form Toggle Button (staff only) -->
        <button id="publishToggle" type="button" class="inline-flex items-center gap-2 px-0 py-2.5 rounded-md font-medium text-sm">
          <input id="publishCheckbox" type="checkbox" {% if is_published %}checked="checked"{% endif %}
          class="toggle border-gray-300 bg-gray-400 checked:border-blue-500 checked:bg-blue-400 checked:text-blue-800" />
          <span class="text-xl" id="publishText">{% if is_published %}Unpublish Form{% else %}Publish Form{% endif %}</span>
        </button>
      </div>
      
      <div class="flex flex-col sm:flex-row gap-3 items-center justify-center sm:justify-end w-full sm:w-auto"> 
        <!-- Download Excel Button (staff only) -->
        <a href="{% url 'registration:download_excel' %}"
        class="inline-flex items-center justify-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1  bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-md font-medium text-sm transition-all duration-200 transform hover:scale-105 hover:from-emerald-600 hover:to-emerald-700 hover:shadow-lg focus:outline-none focus:ring-emerald-500 focus:ring-offset-2">
        <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
          <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
        </svg>
        <span>Download Excel Sheet</span>
      </a>

        <a href="{% url 'core:dashboard' %}"
        class="inline-flex items-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-md font-medium text-sm transition-all duration-200 transform hover:scale-105 hover:from-amber-600 hover:to-amber-700 hover:shadow-lg focus:outline-none focus:ring-emerald-500 focus:ring-offset-2">
        <span>Dashboard</span>
      </a>
      
      <!-- See Responses Button (staff only) -->
      <button
      class="inline-flex items-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md font-medium text-sm transition-all duration-200 transform hover:scale-105 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg focus:outline-none focus:ring-blue-500 focus:ring-offset-2">
      <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
        <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V15H17V17M17,13H7V11H17V13M17,9H7V7H17V9Z" />
      </svg>
      <span>See Responses</span>
    </button>
  </div>
  <p class="response_count">Response Count: {{registration_count}}</p>
</div>

</div>
  {% endif %}
  <div class="bg-[#ffffffaa] w-11/12 md:w-3/5 mx-auto" style="backdrop-filter:blur(7px);border-radius:0 0 4px 4px">
    {% if not is_staff_view and not is_published and not registration_closed%}
      <div class="p-6 bg-yellow-50 border border-yellow-300 rounded text-yellow-900 text-center">
        Registration is not open yet. Please check back later.
      </div>
    {% elif not is_staff_view and registration_closed %}
      <div class="p-6 bg-red-50 border border-red-300 rounded text-red-900 text-center">
        Registration is closed as we have reached the maximum number of participants.  
    {% else %}
    <!-- Step indicator
    <div class="flex justify-between mb-8">
      <div id="step1Indicator" class="w-1/3 text-center font-bold text-primary">1. Basic Info</div>
      <div id="step2Indicator" class="w-1/3 text-center text-gray-500">2. Questionnaire</div>
      <div id="step3Indicator" class="w-1/3 text-center text-gray-500">3. Payment</div>
    </div> -->

    <!-- Form wrapper -->
    <form id="registrationForm" method="post" action="/submit-form/">
      {% csrf_token %}
      
      <!-- Step 1: Basic Info -->
      <section id="step1" class="shadow-md p-5 font-medium rounded-md">
<h2 class=" text-center text-2xl mb-3">Basic Info</h2>
    <div class="mb-5">
      <label for="name" class="block text-sm  mb-3">
        Full Name (The Name Will be Used in Certificate)<span class="text-red-500">*</span>
      </label>
      <input type="text" name="name" id="name" placeholder="Enter your Name"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none " required />

    </div>
    <div class="mb-5">
      <label for="email" class="block text-sm  mb-3">
        Email Address<span class="text-red-500">*</span>
      </label>
      <input type="email" name="email" id="email" placeholder="Enter your Email"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none " required />
    </div>
    <div class="mb-5">
      <label for="contact_number" class="block text-sm  mb-3">
        Contact Number<span class="text-red-500">*</span>
      </label>
      <input type="number" name="contact_number" id="contact_number" placeholder="Enter your Contact Number"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none" required />
    </div>
    <div class="mb-5">
      <label class="block text-sm  mb-3">
        Select Your Membership Grade<span class="text-red-500">*</span>
      </label>
      <label>
        <input type="radio" name="membership_type" value="student" required>
        IEEE Student Member (Undergraduate Students, Grade Students Membership)
      </label><br>
      <label>
        <input type="radio" name="membership_type" value="member">
        IEEE Member (IEEE Senior Members, Professional Membership, Faculty Members, Fellow)
      </label><br>
      <label>
        <input type="radio" name="membership_type" value="non_ieee">
        Non-IEEE Member
      </label><br>
    </div>
    <div class="mb-5">
      <label for="ieee_id" class="block text-sm  mb-3">
        IEEE Membership ID(Write N/A if you're Non-IEEE Member)<span class="text-red-500">*</span>
      </label>
      <input type="text" name="ieee_id" id="ieee_id" placeholder="Enter your Membership ID"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none" required />
    </div>
    <div class="mb-5">
      <label for="university" class="block text-sm  mb-3">
        University Name<span class="text-red-500">*</span>
      </label>
      <input type="text" name="university" id="university" placeholder="Enter your University Name"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none" required />
    </div>
    <div class="mb-5">
      <label for="department" class="block text-sm  mb-3">
        University Department Name<span class="text-red-500">*</span>
      </label>
      <input type="text" name="department" id="department" placeholder="Enter your University Department Name"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none" required />
    </div>
    <div class="mb-5">
      <label for="university_id" class="block text-sm  mb-3">
        University ID<span class="text-red-500">*</span>
      </label>
      <input type="number" name="university_id" id="university_id" placeholder="Enter your University ID"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none" required />
    </div>
    <div class="flex justify-center">
      <button onclick="nextStep(1)" class="bg-[#00629b] text-white px-4 py-2 rounded hover:bg-[#00629b68] hover:text-[#00629b] transition-all ease-in-out cursor-pointer" type="button">Continue</button>
    </div>
    </section>

    <!-- Step 2: Questionnaire -->
    <section id="step2" class="hidden shadow-md p-5 font-medium rounded-md">
      <div class="flex items-center justify-between mb-8">
      <!-- Back button on the left -->
      <div class="z-10">
        <button onclick="prevStep(2)" class="rounded-2xl py-1 px-4 bg-[#00629b68] text-[#00629b] cursor-pointer" type="button">
           < Back
        </button>
      </div>

      <!-- Centered Questionnaire Section -->
      <div class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4">
        <h2 class=" text-lg sm:text-2xl truncate text-center">Questionnaire</h2>
      </div>
    </div>

    <div class="mb-5">
      <label for="question1" class="block text-sm  mb-3">
        1. What do you know about  IEEE YP AG? (250 characters max)<span class="text-red-500">*</span>
      </label>
      <textarea id="question1" name="question1" maxlength="250" rows="4"
        class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
        placeholder="Type your answer here..." required></textarea>
    </div>
    <div class="mb-5">
      <label for="question2" class="block text-sm  mb-3">
        2. What do you know about Student Transition and Elevation Partnership (STEP)? (250 characters max)<span
          class="text-red-500">*</span>
      </label>
      <textarea id="question2" name="question2" maxlength="250" rows="4"
        class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
        placeholder="Type your answer here..." required></textarea>
    </div>
    <div class="mb-5">
      <label for="question3" class="block text-sm  mb-3">
        3. Why do you want to be a participant of STEP? (250 characters max)<span class="text-red-500">*</span>
      </label>
      <textarea id="question3" name="question3" maxlength="250" rows="4"
        class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
        placeholder="Type your answer here..." required></textarea>
    </div>
    <div class="mb-5">
      <label for="question4" class="block text-sm  mb-3">
        4. What is your expectation from STEP? (250 characters max)<span class="text-red-500">*</span>
      </label>
      <textarea id="question4" name="question4" maxlength="250" rows="4"
        class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
        placeholder="Type your answer here..." required></textarea>
    </div>
      <div class="flex justify-center">
        <button onclick="nextStep(2)" class="bg-[#00629b] text-white px-4 py-2 rounded hover:bg-[#00629b68] hover:text-[#00629b] transition-all ease-in-out cursor-pointer" type="button">Continue</button>
      </div>
    </section>

    <!-- Step 3: Payment -->
    <section id="step3" class="hidden shadow-md p-5 font-medium rounded-md">
      <!--  back button and title  -->
    <div class="flex items-center justify-between mb-8">
      <!-- Back button on the left -->
      <div class="z-10">
        <button  onclick="prevStep(3)" class="rounded-2xl py-1 px-4 bg-[#00629b68] text-[#00629b] cursor-pointer" type="button">
          < Back
        </button>
      </div>

      <!-- Centered Questionnaire Section -->
      <div class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4">
        <h2 class=" text-lg sm:text-2xl truncate text-center">Payment</h2>
      </div>
    </div>

    <p class="">
      IEEE Student Member 360 taka <br>
      IEEE Member 510 taka <br>
      Non-IEEE Member 560 taka
    </p>
    <div class="my-8">
      <label class="block   mb-3 ">
        Select Payment Method:<span class="text-red-500">*</span>
      </label>

      <label class="mr-4">
        <input type="radio" name="payment_method" value="Nagad" required>
        Nagad
      </label>
      <label>
        <input type="radio" name="payment_method" value="Bkash" required>
        Bkash
      </label>
    </div>

    <div class="mb-5">
      <label for="transaction_id" class="block   mb-3">
        Transaction ID<span class="text-red-500">*</span>
      </label>
      <input type="text" name="transaction_id" id="transaction_id" placeholder="Enter your Transaction ID"
        class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none " required />
    </div>

    <!-- shirt table  -->
    <h2 class="mb-3">Size Chart</h2>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse text-xs sm:text-sm min-w-full bg-gray-50">
        <thead>
          <tr>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-left font-semibold text-gray-700">
              Description</th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">S
            </th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">M
            </th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">L
            </th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">XL
            </th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">2XL
            </th>
            <th class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700">3XL
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="hover:bg-gray-50">
            <td class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700">Chest Width</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">36"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">38"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">40"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">42"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">44"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">46"</td>
          </tr>
          <tr class="hover:bg-gray-50">
            <td class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700">Chest Height
            </td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">25"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">26"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">27"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">28"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">29"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">30"</td>
          </tr>
          <tr class="hover:bg-gray-50">
            <td class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700">Body Length</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">26"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">27"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">28"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">29"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">30"</td>
            <td class="border border-gray-300 px-2 py-2 sm:px-3 text-center">31"</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mb-4 mt-3">
      <label class="block   mb-3 ">
        Select T-Shirt size<span class="text-red-500">*</span>
      </label>
      <div class="flex flex-col gap-2 ml-6">
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="S" class="form-radio text-blue-500" required>
          S
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="M" class="form-radio text-blue-500" required>
          M
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="L" class="form-radio text-blue-500" required>
          L
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="XL" class="form-radio text-blue-500" required>
          XL
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="2XL" class="form-radio text-blue-500" required>
          2XL
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tshirt_size" value="3XL" class="form-radio text-blue-500" required>
          3XL
        </label>
      </div>
    </div>

    <div class="mb-5">
      <label for="comments" class="block text-sm  mb-3">
        Any Comments:
      </label>
      <textarea id="comments" name="comments" maxlength="250" rows="4"
        class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
        placeholder="Your comment..."></textarea>
    </div>
      <div class="flex justify-center">
        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 cursor-pointer">Submit</button>
      </div>
    </section>
    </form>
    {% endif %}
  </div>
  <script>
    function validateStep(stepNumber) {
  const currentStep = document.getElementById(`step${stepNumber}`);
  const requiredFields = currentStep.querySelectorAll('[required]');
  let isValid = true;
  
  requiredFields.forEach(field => {
    if (field.type === 'radio') {
      const radioGroup = currentStep.querySelectorAll(`[name="${field.name}"]`);
      const isChecked = Array.from(radioGroup).some(radio => radio.checked);
      if (!isChecked) isValid = false;
    } else if (!field.value.trim()) {
      isValid = false;
    }
  });
  
  return isValid;
}
   function nextStep(current) {
  if (!validateStep(current)) {
    alert('Please fill all required fields!');
    return;
  }
  document.getElementById(`step${current}`).classList.add("hidden");
  document.getElementById(`step${current + 1}`).classList.remove("hidden");
  updateIndicators(current + 1);
}

    function prevStep(current) {
      document.getElementById(`step${current}`).classList.add("hidden");
      document.getElementById(`step${current - 1}`).classList.remove("hidden");
      updateIndicators(current - 1);
    }

   function updateIndicators(step) {
  // Check if indicators exist
  if (!document.getElementById('step1Indicator')) {
    return;
  }
  
  [1, 2, 3].forEach(num => {
    const indicator = document.getElementById(`step${num}Indicator`);
    if (indicator) {
      indicator.classList.remove("text-primary", "font-bold");
      indicator.classList.add("text-gray-500");
    }
  });
  
  const activeIndicator = document.getElementById(`step${step}Indicator`);
  if (activeIndicator) {
    activeIndicator.classList.remove("text-gray-500");
    activeIndicator.classList.add("text-primary", "font-bold");
  }
}

    // Handle form submission
    document.getElementById('registrationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Show loading state
      const submitBtn = document.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      submitBtn.disabled = true;
      
      
      // using formdata to handle file uploads
      const formData = new FormData(this);
      
      // fetch API to submit form data
      fetch(this.action, {
        method: 'POST',
        body: formData, 
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || ''
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Show success message
        //  alert('Registration successful! Your participant ID is: ' + data.participant_id);
        Swal.fire({
  title: "Submitted Successfully",
  icon: "success",
  draggable: true
});
          // Reset form
          this.reset();
        // Go back to step 1
const step3 = document.getElementById('step3');
const step1 = document.getElementById('step1');
if (step3) step3.classList.add('hidden');
if (step1) step1.classList.remove('hidden');
updateIndicators(1);
        } else {
          alert('Registration failed: ' + data.message);
        }
      })
      .catch(error => {
        alert('Registration failed: ' + error.message);
      })
      .finally(() => {
        // Reset button state
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      });
    });

    // handle publish toggle
    const publishCheckbox = document.getElementById('publishCheckbox');
    if (publishCheckbox) {
      publishCheckbox.addEventListener('change', function() {
        fetch('{% url "registration:toggle_publish" %}', {
          method: 'POST',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          }
        })
        .then(r => r.json())
        .then(data => {
          const publishText = document.getElementById('publishText');
          if (data.is_published) {
            publishText.textContent = 'Unpublish Form';
          } else {
            publishText.textContent = 'Publish Form';
          }
          alert('Publish status: ' + (data.is_published ? 'Published' : 'Unpublished'));
        })
        .catch(err => alert('Failed to toggle publish: ' + err.message));
      });
    }
  </script>
</body>

</html>
